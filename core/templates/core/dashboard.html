<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loan Tracer Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f4f4f4;
    }
    .card h2 {
      font-size: 36px;
      margin: 10px 0;
    }
    .green {
      color: green;
    }
    .red {
      color: red;
    }
    .add-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: #4CAF50;
      color: white;
      padding: 12px 20px;
      border-radius: 50px;
      font-size: 18px;
      text-decoration: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .recent-grid ul li {
      background: #f7f7f7;
      margin-bottom: 8px;
      padding: 8px 10px;
      border-radius: 6px;
      font-size: 0.95em;
    }
  </style>
</head>
<body>

  <div class="container py-4">
    <h1 class="text-center mb-4">Loan Tracer Dashboard</h1>

    <form method="get" class="text-center mb-4">
      <input type="text" name="name" class="form-control d-inline-block w-auto me-2" placeholder="Search by name" value="{{ name_query }}" />
      <input type="date" name="date" class="form-control d-inline-block w-auto me-2" value="{{ date_query }}" />
      <button type="submit" class="btn btn-primary">🔍 Filter</button>
      <a href="/" class="btn btn-outline-secondary ms-2">Clear</a>
    </form>

    <div class="text-end mb-3">
      <a href="{% url 'data_entry' %}" class="btn btn-success">
        ➕ Add New Record
      </a>
    </div>

    <div class="row g-3">
      <div class="col-md-3 col-sm-6">
        <div class="card text-center p-3 shadow-sm">
          <span>Total Clients</span>
          <h2>{{ total_clients }}</h2>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="card text-center p-3 shadow-sm">
          <span>Total Loaned</span>
          <h2>KES {{ total_loaned }}</h2>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="card text-center p-3 shadow-sm">
          <span>Total Collected</span>
          <h2>KES {{ total_collected }}</h2>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="card text-center p-3 shadow-sm">
          <span>Total Remaining</span>
          <h2 class="{% if total_remaining <= 0 %}green{% else %}red{% endif %}">
            KES {{ total_remaining }}
          </h2>
        </div>
      </div>
    </div>

    <hr class="my-5">

    {% load humanize %}
<div class="row g-3 my-4">
  <div class="col-md-4 col-sm-6">
    <div class="card text-center p-3 shadow-sm">
      <span>📅 <strong>Opening ({{ today }})</strong></span>
      <h2 class="text-primary">KES {{ opening|floatformat:0|intcomma }}</h2>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card text-center p-3 shadow-sm">
      <span>💸 Loans Today</span>
      <h2 class="text-danger">KES {{ total_today_loans|floatformat:0|intcomma }}</h2>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card text-center p-3 shadow-sm">
      <span>✅ Payments Today</span>
      <h2 class="text-success">KES {{ total_today_collections|floatformat:0|intcomma }}</h2>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card text-center p-3 shadow-sm">
      <span>🧾 Money Out Today</span>
      <h2 class="text-warning">KES {{ total_today_moneyout|floatformat:0|intcomma }}</h2>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card text-center p-3 shadow-sm">
      <span>🔐 <strong>Closing ({{ today }})</strong></span>
      <h2 class="text-purple" style="color: #8e44ad;">KES {{ closing_balance|floatformat:0|intcomma }}</h2>
    </div>
  </div>
</div>


    <div class="text-center my-4">
      <a href="{% url 'daily-summary' %}" class="btn btn-outline-dark m-2">📅 Daily Summary</a>
      <a href="{% url 'client-summary' %}" class="btn btn-outline-dark m-2">👥 Client Summary</a>
      <a href="{% url 'daily-summary-pdf' %}?date={{ date_query|default:today|date:'Y-m-d' }}" class="btn btn-outline-primary m-2" target="_blank">📁 Daily PDF</a>
      <a href="{% url 'client-summary-pdf' %}?name={{ name_query }}" class="btn btn-outline-primary m-2" target="_blank">📁 Client PDF</a>
    </div>
  </div>

  <!-- Floating Add Button -->
  <a href="{% url 'data_entry' %}" class="add-button" title="Add New Entry">＋</a>

  <!-- Optional Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
